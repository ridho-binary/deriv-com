version: 2

defaults: &defaults
  docker:
    - image: circleci/ruby:2.6-stretch-node-browsers-legacy
  working_directory: ~/repo

jobs:
  visual:
    <<: *defaults
    steps:
      - checkout
      - run:
         name: install dependencies
         command: |
          npm install
          gem install percy-cli

      - run:
          name: Run visual test
          command: |
           npm run build
           percy snapshot public

workflows:
  version: 2
  visual-test:
     jobs:
       - visual